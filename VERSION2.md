# OBT v2

## Цель

1. Это должен быть инструмент, с помощью которого можно легко просматривать ресурсы с git.door43.
2. В процессе разработки надо думать о том, как создавать переиспользуемые компоненты.

## Ресурсы

Открытые Библейские Истории, Библия, заметки к переводу, словарные статьи, вопросы к переводу, заметки для изучения (они пока что мало где есть), вопросы для изучения (их тоже мало), лексикон для древнегреческого и иврита, академия перевода

## Что сейчас есть

- отображение последних релизов всех материалов (писание, истории, заметки, слова и т.д.)
- навигация
- отображение одной главы
- отображение нескольких ресурсов одновременно и их синхронизация
- отображение лексикона для слова, если есть привязка к языку оригинала (по наведению на слово)
- подсветка фразы для tnotes (все заметки пишутся к фразе на языке оригинала), если библейский текст с привязкой

## Что нам надо

- реализовать поиск по ресурсам или хотя бы по одному ресурсу
- синхронизировать окно twords и библию, если кликаешь по слову - чтобы его открывало
- реализовать поддержку версификации текстов
- полноценное pwa с кешированием и работой оффлайн
- возможность создания мобильного приложения без доступа к интернету
- продумать, чтобы по прямой ссылке можно было открыть ресурсы

## Технологии и библиотеки

**NextJS** - основной фреймворк. Нам нужно будет несколько роутов, удобно что тут есть апи, так мы можем разделить код и преобразования оставить на стороне сервера. Кроме того есть способы создать на основе приложения на **nextjs** нативное приложение. Единственное - мы просто перепишем апи под формат для приложения электрон.

**tailwind** - все что связано со стилями

**proskomma** - все манипуляции с библейским текстом: получение одной главы, версификация, поиск, вывод параллельных стихов, номера стронга, морфология и т.д.

**swr** - для кеширования запросов к апи. Все сторонние запросы на ресурсы мы не будем выполнять на клиенте, все на сервере через наш апи.

**dcs-js** - для получения материалов с dcs. Может быть достаточно использовать api напрямую, нам нужен только один роут - получить все релизы. А материалы мы уже получаем по ссылкам

**recoil** - для сохранения состояний. Сейчас в обт у нас один глобальный стейт и это не хорошо. Тут будем разбивать.

**bible-reference-rcl** - библиотека для общего референса

**resource-workspace-rcl** - эта библиотека используется сейчас для того чтобы были карточки которые можно переносить, скорее всего оставляем

## Идеи

- будем использовать уже готовые библиотеки, только если они не тянут за собой кучу доп. зависимостей
- надо быть готовым сделать не итоговый продукт а библиотеки, по этому не страшно если разработка будет идти не так быстро, как хочется
- если не получается создать библиотеку, то тогда хотя бы попробовать написать какую-то статью или инструкцию того, как можно использовать тот или иной инструмент. По этому стоит где-то фиксировать и систематизировать наши исследования
- кажется можно создать библиотеки для работы с **pk** для отображения материалов. Сейчас uW работают над редактированием контента, Mark Howe работает над отображением, но там речь про мобильное приложение вроде
- не забыть про локализацию, аналитику, сео (лучше это заложить сразу)
- обрабатывать в тексте все референсы, чтобы в модалке к примеру показывать текст этого библейского отрывка
- не забывать, что мы работаем не только с Писанием но и с историями
- попробовать как-то отобразить видео-словарь и аудио перевод
- может стоит одновременно и электрон версию начать разрабатывать. Нам не к спеху выпустить прям сейчас обт, а если посмотреть на пример с виканой, электрон версия отличается, и пришлось удалять часть кода из компонентов, чтобы они смогли работать в веб версии. Может мы смогли бы это сразу учесть.
- может быть стоит сразу и для мобильной версии создать заготовку, чтобы тоже учесть ее ограничения
- еще один фокус это оффлайн, чтобы можно было не только с интернета скачивать ресурсы но и загружать на прямую в программу, и чтобы все корректно работало и отображалось
- еще пришла идея, сейчас в обт нужно чтобы как минимум 1 карточка с Библией или оби была открыта, иначе от чего считать референс. А что если мы ее как-то выделим и будем считать это основным ресурсом. Тогда к нему уже будем привязывать все остальное. К примеру перевод для tn, tw.

## Вопросы

- в приоритете доработать чужую библиотеку или же сделать свою?
- нужно ли использовать **proskomma-freeze**? Весь смысл кода - поместить доксет в архив, чтобы он занимал меньше места, и потом извлечь. Если мы хотим кешировать, то можно использовать этот код, но в связке с сохранением в хранилище браузера. И надо понять, как это же использовать потом в мобильном приложении и в standalone приложении.
- точно не будем использовать **mui** вместо **tailwind**? Просто в пользу **mui** - библиотеки, которые разрабатываются, используют его, в доках по разработке rcl uW писали что стек это **react** + **mui** чтобы не заморачиваться с дизайном и фокусироваться только на разработке, плюс ко всему **mui** можно так же кастомизировать

## Дополнительные библиотеки

- **single-scripture-rcl** для отображения Библии. Нужно ли или же ее не использовать в контексте проскомы? Может стоит дополнить эту библиотеку поддержкой формата проскомы или лучше написать свое? Стоит ли писать свое, или это можно решить используя к примеру софрия?
- **translation-helps-rcl** у нас сейчас используется для отображения всех доп материалов. Скорее всего тут нам уже проскома не понадобится. Но минус в том что она в зависимостях тянет много того, что нам не надо. Надо проверить, так ли это сейчас. И подумать о том, стоит ли эту допилить, или сделать форк, как сейчас это и работает, или же написать что-то новое, свое. Используя не **mui** а **tailwind** а может быть и что-то headless чтобы чисто получал данные и возвращал в удобном формате.
- **uw-languages-rcl** у них есть файл, json в котором данные по всем языкам, более 9000. И этот файл присутствовал, по крайней мере раньше, в нескольких рсл, файл попадал в билд и в итоге приложение было большим из за него, и библиотеки. А сути от этого файла было мало. Тут Абель сделал библиотеку и берет его из сети. Надо будет проверить, рабочий ли это вариант. Так как сейчас в обт мы хардкодим список языков просто (на самом деле языков, на котором есть релиз хотя бы оби, не так много, может 50 всего)
- **bible-reference-range** - для работы с диапазонами стихов. Они встречаются в вопросах, когда к примеру вопрос записан для нескольких стихов.
- **uw-tsv-parser** для работы с tsv, но в нашей библиотеке **tn-quote** я тоже делал парсер tsv, обратная конвертация нам не нужна так что можно и его использовать
- **scripture-resources-rcl** - библиотека, от которой я очень хотел избавиться в обт. Она тормозит и тут мудреный рендер главы. Это то что хочется заменить на проскому, если это возможно.
- **uw-quote-helpers** - мне кажется эта библиотека должна делать то же самое что и наша **tn-quote**. Нужно будет проверить
